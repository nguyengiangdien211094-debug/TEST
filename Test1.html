<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªánh C√¥ng T√°c - Ph·ª• L·ª•c B</title>
    <style>
        body { font-family: 'Times New Roman', Times, serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; background: #fff; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Ti√™u ƒë·ªÅ */
        h1, h2, h3 { text-align: center; margin: 10px 0; text-transform: uppercase; }
        h1 { font-size: 16pt; font-weight: bold; }
        h3 { font-size: 13pt; background: #e9ecef; padding: 5px; border-radius: 4px; text-align: left; }

        /* C√°c tr∆∞·ªùng nh·∫≠p li·ªáu */
        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: #333; }
        .inline-label { display: inline; font-weight: normal; margin-right: 5px; }
        
        input[type="text"], input[type="number"], input[type="datetime-local"], textarea {
            width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
            box-sizing: border-box; font-family: inherit; font-size: 14px;
        }
        textarea { height: 60px; resize: vertical; }
        
        /* Input nh·ªè cho ng√†y th√°ng, b·∫≠c an to√†n */
        .input-mini { width: 60px !important; display: inline-block !important; text-align: center; }
        .input-small { width: 150px !important; display: inline-block !important; }

        /* B·∫£ng bi·ªÉu */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; vertical-align: middle; }
        th { background-color: #f8f9fa; font-weight: bold; }
        
        /* Ch·ªØ k√Ω */
        .signature-section { display: flex; justify-content: space-between; margin-top: 30px; }
        .signature-box { width: 45%; text-align: center; }
        .signature-box p { font-style: italic; margin-top: 5px; }
        .signature-input { border: none; border-bottom: 1px dashed #000; text-align: center; margin-top: 40px; background: transparent; }

        /* Thanh c√¥ng c·ª• c·ªë ƒë·ªãnh ph√≠a d∆∞·ªõi */
        .toolbar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #343a40; padding: 15px; text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2); z-index: 1000;
        }
        button {
            padding: 10px 20px; margin: 0 10px; cursor: pointer;
            border: none; border-radius: 4px; font-weight: bold; color: white;
        }
        .btn-save { background: #28a745; }
        .btn-load { background: #007bff; }
        .btn-new { background: #6c757d; }
        button:hover { opacity: 0.9; }
        
        #searchKey { width: 200px; padding: 10px; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-group">
        <label>T√äN ƒê∆†N V·ªä C·∫§P L·ªÜNH:</label>
        <input type="text" id="unitName" placeholder="Nh·∫≠p t√™n ƒë∆°n v·ªã...">
    </div>
    
    <h1>L·ªÜNH C√îNG T√ÅC</h1>
    <div style="text-align: center;">
        S·ªë: <input type="text" id="orderNumber" class="input-small" placeholder="S·ªë l·ªánh...">
    </div>

    <h3>A. PH·∫¶N L∆ØU GI·ªÆ C·ª¶A NG∆Ø·ªúI RA L·ªÜNH</h3>
    
    <div class="form-group">
        <label>1. Ng∆∞·ªùi ch·ªâ huy tr·ª±c ti·∫øp:</label>
        <input type="text" id="commanderA" style="width: 60%; display: inline-block;">
        <span class="inline-label">B·∫≠c ATƒê:</span>
        <input type="number" id="safetyLevelA" class="input-mini">/5
    </div>

    <div class="form-group">
        <label>2. Nh√¢n vi√™n ƒë∆°n v·ªã c√¥ng t√°c:</label>
        S·ªë l∆∞·ª£ng: <input type="number" id="staffCountA" class="input-mini"> ng∆∞·ªùi.
        Thu·ªôc: <input type="text" id="staffUnitA" class="input-small" style="width: 300px !important;">
        
        <table id="tableStaffA">
            <thead>
                <tr>
                    <th style="width: 50px;">TT</th>
                    <th>H·ªç v√† t√™n</th>
                    <th style="width: 100px;">B·∫≠c ATƒê</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><input type="text" class="staff-name"></td>
                    <td><input type="number" class="staff-safety input-mini">/5</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><input type="text" class="staff-name"></td>
                    <td><input type="number" class="staff-safety input-mini">/5</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td><input type="text" class="staff-name"></td>
                    <td><input type="number" class="staff-safety input-mini">/5</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="form-group">
        <label>3. ƒê·ªãa ƒëi·ªÉm c√¥ng t√°c:</label>
        <textarea id="locationA"></textarea>
    </div>
    <div class="form-group">
        <label>4. N·ªôi dung c√¥ng t√°c:</label>
        <textarea id="contentA"></textarea>
    </div>
    <div class="form-group">
        <label>5. ƒêi·ªÅu ki·ªán an to√†n:</label>
        <textarea id="safetyCondA"></textarea>
    </div>
    <div class="form-group">
        <label>6. Th·ªùi gian b·∫Øt ƒë·∫ßu (K·∫ø ho·∫°ch):</label>
        <input type="datetime-local" id="startTimeA">
    </div>

    <div class="signature-section">
        <div class="signature-box" style="margin-left: auto;">
            <label>Ng∆∞·ªùi ra l·ªánh c√¥ng t√°c</label>
            <p>(K√Ω, ghi h·ªç t√™n)</p>
            <input type="text" id="signerA" class="signature-input" placeholder="Nh·∫≠p t√™n...">
        </div>
    </div>

    <hr style="border-top: 2px dashed #999; margin: 30px 0;">

    <h3>B. PH·∫¶N GIAO CHO NG∆Ø·ªúI CH·ªà HUY TR·ª∞C TI·∫æP</h3>

    <div class="form-group">
        <label>1. N·ªôi dung l·ªánh (Ph·∫ßn B):</label>
        <p>1.1. Ng∆∞·ªùi ch·ªâ huy tr·ª±c ti·∫øp: <span id="displayCommanderB" style="font-weight: bold;">(Nh∆∞ tr√™n)</span></p>
        
        <label>1.2. Danh s√°ch nh√¢n vi√™n & Bi·∫øn ƒë·ªông:</label>
        <table id="tableStaffB">
            <thead>
                <tr>
                    <th rowspan="2">TT</th>
                    <th rowspan="2">H·ªç t√™n</th>
                    <th rowspan="2">B·∫≠c ATƒê</th>
                    <th colspan="2">ƒê·∫øn l√†m vi·ªác</th>
                    <th colspan="2">R√∫t kh·ªèi</th>
                </tr>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>K√Ω t√™n</th>
                    <th>Th·ªùi gian</th>
                    <th>K√Ω t√™n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><input type="text"></td>
                    <td><input type="text" class="input-mini"></td>
                    <td><input type="text" placeholder="Gi·ªù, ng√†y"></td>
                    <td><input type="text" class="input-mini"></td>
                    <td><input type="text" placeholder="Gi·ªù, ng√†y"></td>
                    <td><input type="text" class="input-mini"></td>
                </tr>
                 <tr>
                    <td>2</td>
                    <td><input type="text"></td>
                    <td><input type="text" class="input-mini"></td>
                    <td><input type="text" placeholder="Gi·ªù, ng√†y"></td>
                    <td><input type="text" class="input-mini"></td>
                    <td><input type="text" placeholder="Gi·ªù, ng√†y"></td>
                    <td><input type="text" class="input-mini"></td>
                </tr>
            </tbody>
        </table>
        
        <div style="margin-top: 10px;">
            <label>1.6. Th·ªùi gian b·∫Øt ƒë·∫ßu (Th·ª±c t·∫ø):</label>
            <input type="datetime-local" id="startTimeB">
        </div>
    </div>

    <div class="form-group">
        <label>2. Th·ª±c hi·ªán l·ªánh:</label>
        <div>
            <span class="inline-label">2.2. Ng∆∞·ªùi gi√°m s√°t an to√†n (n·∫øu c√≥):</span>
            <input type="text" id="supervisor" class="input-small" style="width: 200px !important;">
            <span class="inline-label">ƒê∆°n v·ªã:</span>
            <input type="text" id="supervisorUnit" class="input-small">
        </div>
        
        <label style="margin-top: 10px;">2.3. Tr√¨nh t·ª± c√¥ng vi·ªác & ƒêi·ªÅu ki·ªán an to√†n:</label>
        <table id="tableSequence">
            <thead>
                <tr>
                    <th>TT</th>
                    <th>Tr√¨nh t·ª± c√¥ng vi·ªác</th>
                    <th>ƒêi·ªÅu ki·ªán an to√†n</th>
                    <th>B·∫Øt ƒë·∫ßu</th>
                    <th>K·∫øt th√∫c</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><input type="text" class="seq-work"></td>
                    <td><input type="text" class="seq-safe"></td>
                    <td><input type="text" class="input-mini" placeholder="Gi·ªù"></td>
                    <td><input type="text" class="input-mini" placeholder="Gi·ªù"></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><input type="text" class="seq-work"></td>
                    <td><input type="text" class="seq-safe"></td>
                    <td><input type="text" class="input-mini" placeholder="Gi·ªù"></td>
                    <td><input type="text" class="input-mini" placeholder="Gi·ªù"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="form-group">
        <label>3. K·∫øt th√∫c c√¥ng t√°c:</label>
        <div>
            L√†m xong c√¥ng vi·ªác l√∫c: <input type="datetime-local" id="endTime" style="width: auto;">
        </div>
        <div style="margin-top: 10px;">
            ƒê√£ b√°o cho √¥ng/b√†: <input type="text" id="reportedPerson" class="input-small">
            Ch·ª©c danh: <input type="text" id="reportedTitle" class="input-small">
        </div>
    </div>

    <div class="signature-section">
        <div class="signature-box">
            <label>Ng∆∞·ªùi ch·ªâ huy tr·ª±c ti·∫øp</label>
            <p>(K√Ω, ghi h·ªç t√™n)</p>
            <input type="text" id="signerCommanderEnd" class="signature-input">
        </div>
        <div class="signature-box">
            <label>Ng∆∞·ªùi ra l·ªánh c√¥ng t√°c</label>
            <p>(ƒê√£ ki·ªÉm tra, k√Ω t√™n)</p>
            <input type="text" id="signerOrderEnd" class="signature-input">
        </div>
    </div>
</div>

<div style="height: 80px;"></div> <div class="toolbar">
    <input type="text" id="searchKey" placeholder="Nh·∫≠p S·ªë L·ªánh ƒë·ªÉ t√¨m ki·∫øm...">
    <button class="btn-load" onclick="loadData()">üìÇ T√¨m Ki·∫øm</button>
    <button class="btn-save" onclick="saveData()">üíæ L∆∞u L·∫°i</button>
    <button class="btn-new" onclick="resetForm()">üìù T·∫°o M·ªõi</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    // ============================================================
    // C·∫§U H√åNH FIREBASE - THAY TH·∫æ PH·∫¶N N√ÄY
    // ============================================================
    const firebaseConfig = {
        apiKey: "API_KEY_CUA_BAN",
        authDomain: "PROJECT_ID.firebaseapp.com",
        databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
        projectId: "PROJECT_ID",
        storageBucket: "PROJECT_ID.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };
    // ============================================================

    // Kh·ªüi t·∫°o Firebase
    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        console.log("Firebase connected");
    } catch (e) {
        console.error("Firebase Init Error:", e);
        alert("L·ªói c·∫•u h√¨nh Firebase! Vui l√≤ng ki·ªÉm tra console.");
    }

    // --- H√ÄM L∆ØU D·ªÆ LI·ªÜU ---
    function saveData() {
        const orderNum = document.getElementById('orderNumber').value.trim();
        if (!orderNum) { alert("Vui l√≤ng nh·∫≠p S·ªë L·ªánh!"); return; }

        // Thu th·∫≠p d·ªØ li·ªáu nh√¢n vi√™n (Ph·∫ßn A)
        const staffListA = [];
        const rowsA = document.querySelectorAll('#tableStaffA tbody tr');
        rowsA.forEach(row => {
            const inputs = row.querySelectorAll('input');
            if(inputs[0].value) { // Ch·ªâ l·∫•y d√≤ng c√≥ t√™n
                staffListA.push({ name: inputs[0].value, safety: inputs[1].value });
            }
        });

        // Object d·ªØ li·ªáu t·ªïng h·ª£p
        const data = {
            meta: {
                unit: document.getElementById('unitName').value,
                id: orderNum,
                created: new Date().toISOString()
            },
            sectionA: {
                commander: document.getElementById('commanderA').value,
                safetyLevel: document.getElementById('safetyLevelA').value,
                staffCount: document.getElementById('staffCountA').value,
                staffUnit: document.getElementById('staffUnitA').value,
                location: document.getElementById('locationA').value,
                content: document.getElementById('contentA').value,
                safetyCond: document.getElementById('safetyCondA').value,
                startTime: document.getElementById('startTimeA').value,
                staffList: staffListA,
                signer: document.getElementById('signerA').value
            },
            sectionB: {
                // C√≥ th·ªÉ m·ªü r·ªông ƒë·ªÉ l∆∞u chi ti·∫øt b·∫£ng B n·∫øu c·∫ßn
                startTimeReal: document.getElementById('startTimeB').value,
                supervisor: document.getElementById('supervisor').value,
                supervisorUnit: document.getElementById('supervisorUnit').value,
                endTime: document.getElementById('endTime').value,
                reportedPerson: document.getElementById('reportedPerson').value,
                signerCommander: document.getElementById('signerCommanderEnd').value,
                signerOrder: document.getElementById('signerOrderEnd').value
            }
        };

        // L∆∞u l√™n Firebase: lenh_cong_tac/[so_lenh]
        db.ref('lenh_cong_tac/' + orderNum).set(data)
            .then(() => alert("ƒê√£ l∆∞u th√†nh c√¥ng l·ªánh s·ªë: " + orderNum))
            .catch(err => alert("L·ªói l∆∞u d·ªØ li·ªáu: " + err.message));
    }

    // --- H√ÄM T·∫¢I D·ªÆ LI·ªÜU ---
    function loadData() {
        const key = document.getElementById('searchKey').value.trim();
        if(!key) { alert("Nh·∫≠p s·ªë l·ªánh c·∫ßn t√¨m!"); return; }

        db.ref('lenh_cong_tac/' + key).once('value').then(snapshot => {
            const val = snapshot.val();
            if(!val) { alert("Kh√¥ng t√¨m th·∫•y l·ªánh s·ªë: " + key); return; }
            
            // Fill d·ªØ li·ªáu
            document.getElementById('unitName').value = val.meta.unit || '';
            document.getElementById('orderNumber').value = val.meta.id || '';
            
            // Ph·∫ßn A
            if(val.sectionA) {
                document.getElementById('commanderA').value = val.sectionA.commander || '';
                document.getElementById('safetyLevelA').value = val.sectionA.safetyLevel || '';
                document.getElementById('staffCountA').value = val.sectionA.staffCount || '';
                document.getElementById('staffUnitA').value = val.sectionA.staffUnit || '';
                document.getElementById('locationA').value = val.sectionA.location || '';
                document.getElementById('contentA').value = val.sectionA.content || '';
                document.getElementById('safetyCondA').value = val.sectionA.safetyCond || '';
                document.getElementById('startTimeA').value = val.sectionA.startTime || '';
                document.getElementById('signerA').value = val.sectionA.signer || '';

                // Fill b·∫£ng nh√¢n vi√™n
                if(val.sectionA.staffList) {
                    const rows = document.querySelectorAll('#tableStaffA tbody tr');
                    val.sectionA.staffList.forEach((staff, idx) => {
                        if(rows[idx]) {
                            const inputs = rows[idx].querySelectorAll('input');
                            inputs[0].value = staff.name;
                            inputs[1].value = staff.safety;
                        }
                    });
                }
            }

            // Ph·∫ßn B
            if(val.sectionB) {
                document.getElementById('startTimeB').value = val.sectionB.startTimeReal || '';
                document.getElementById('supervisor').value = val.sectionB.supervisor || '';
                document.getElementById('supervisorUnit').value = val.sectionB.supervisorUnit || '';
                document.getElementById('endTime').value = val.sectionB.endTime || '';
                document.getElementById('reportedPerson').value = val.sectionB.reportedPerson || '';
                document.getElementById('signerCommanderEnd').value = val.sectionB.signerCommander || '';
                document.getElementById('signerOrderEnd').value = val.sectionB.signerOrder || '';
            }
            alert("ƒê√£ t·∫£i d·ªØ li·ªáu!");
        });
    }

    function resetForm() {
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tr·∫Øng form ƒë·ªÉ nh·∫≠p m·ªõi?")) {
            document.querySelectorAll('input, textarea').forEach(e => e.value = '');
        }
    }
</script>

</body>
</html>
